<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"www.wudi.space","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="最近上了一门公开课，带着我们大致阅读了一边Spring AOP的源码，为了加强理解，自己再整理一遍。本文中使用的Spring Boot版本为2.4.0，Spring版本为5.3.1。   当然，首先再回顾一下AOP的用法，以及一些名词解释。">
<meta property="og:type" content="article">
<meta property="og:title" content="阅读源码-SpringAOP-01使用">
<meta property="og:url" content="https://www.wudi.space/2020/12/11/ReadSource-SpringAop-01Usage/index.html">
<meta property="og:site_name" content="吴迪小站">
<meta property="og:description" content="最近上了一门公开课，带着我们大致阅读了一边Spring AOP的源码，为了加强理解，自己再整理一遍。本文中使用的Spring Boot版本为2.4.0，Spring版本为5.3.1。   当然，首先再回顾一下AOP的用法，以及一些名词解释。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://www.wudi.space/2020/12/11/ReadSource-SpringAop-01Usage/UseAOP-Greeting.png">
<meta property="og:image" content="https://www.wudi.space/2020/12/11/ReadSource-SpringAop-01Usage/UseAOP-Userinfo.png">
<meta property="og:image" content="https://www.wudi.space/2020/12/11/ReadSource-SpringAop-01Usage/UseAOP-Exception.png">
<meta property="og:image" content="https://www.wudi.space/2020/12/11/ReadSource-SpringAop-01Usage/UseAOP-OriginAdviseFlow.png">
<meta property="og:image" content="https://www.wudi.space/2020/12/11/ReadSource-SpringAop-01Usage/UseAOP-NowAdviseFlow.png">
<meta property="og:image" content="https://www.wudi.space/2020/12/11/ReadSource-SpringAop-01Usage/OfficialDocForOrder.png">
<meta property="og:image" content="https://www.wudi.space/2020/12/11/ReadSource-SpringAop-01Usage/CallStackForAfterReturning.png">
<meta property="og:image" content="https://www.wudi.space/2020/12/11/ReadSource-SpringAop-01Usage/CallStackForAroundReturningOnOldVersion.png">
<meta property="article:published_time" content="2020-12-11T09:45:52.000Z">
<meta property="article:modified_time" content="2020-12-15T01:24:39.956Z">
<meta property="article:author" content="吴迪">
<meta property="article:tag" content="源码">
<meta property="article:tag" content="Spring">
<meta property="article:tag" content="AOP">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://www.wudi.space/2020/12/11/ReadSource-SpringAop-01Usage/UseAOP-Greeting.png">

<link rel="canonical" href="https://www.wudi.space/2020/12/11/ReadSource-SpringAop-01Usage/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>阅读源码-SpringAOP-01使用 | 吴迪小站</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">吴迪小站</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.wudi.space/2020/12/11/ReadSource-SpringAop-01Usage/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg?raw=true">
      <meta itemprop="name" content="吴迪">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="吴迪小站">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          阅读源码-SpringAOP-01使用
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-12-11 17:45:52" itemprop="dateCreated datePublished" datetime="2020-12-11T17:45:52+08:00">2020-12-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-12-15 09:24:39" itemprop="dateModified" datetime="2020-12-15T09:24:39+08:00">2020-12-15</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E9%98%85%E8%AF%BB%E6%BA%90%E7%A0%81/" itemprop="url" rel="index"><span itemprop="name">阅读源码</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>最近上了一门公开课，带着我们大致阅读了一边Spring AOP的源码，为了加强理解，自己再整理一遍。本文中使用的Spring Boot版本为2.4.0，Spring版本为5.3.1。  </p>
<p>当然，首先再回顾一下AOP的用法，以及一些名词解释。<br><a id="more"></a></p>
<h1 id="用法用例"><span class="post-title-index">1. </span><a href="#用法用例" class="headerlink" title="用法用例"></a>用法用例</h1><h2 id="创建工程"><span class="post-title-index">1.1. </span><a href="#创建工程" class="headerlink" title="创建工程"></a>创建工程</h2><p>创建一个工程（我已经将源码上传到了GitHub上，有需要的可以自行查看，<a href="https://github.com/discko/ReadSource/tree/master/readsource-aop" target="_blank" rel="noopener">传送门</a>）。<br>如果使用SpringBoot的话，记得引入AOP的starter。  </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.4.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="创建需要被插入切面的Controller"><span class="post-title-index">1.2. </span><a href="#创建需要被插入切面的Controller" class="headerlink" title="创建需要被插入切面的Controller"></a>创建需要被插入切面的Controller</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> space.wudi.readsourceaop.jdkdynamicproxy.controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> space.wudi.readsourceaop.jdkdynamicproxy.bean.User;</span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/greeting"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getInfo</span><span class="params">(String fromInfo)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Hi, "</span>+fromInfo+<span class="string">"!"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/userinfo"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getUserInfo</span><span class="params">(String fromInfo)</span></span>&#123;</span><br><span class="line">        <span class="comment">// User is a simple POJO, contains 2 fields:</span></span><br><span class="line">        <span class="comment">// username and email</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> User(fromInfo, <span class="string">"email"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/exception"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">throwException</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"an error occurred in controller"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>那么正常访问时  </p>
<ul>
<li>对于第一个接口<code>/greeting</code>，将会返回一个字符串，比如<code>fromInfo = WuDi</code>，则会返回<code>Hi, WuDi!</code>。  </li>
<li>对于第二个接口，将会返回一个JSON对象，如果<code>fromInfo = WuDi</code>，则返回<code>{&quot;username&quot;:&quot;WuDi&quot;,&quot;email&quot;:&quot;email&quot;}</code>。</li>
<li>对于第三个接口，将会报错。</li>
</ul>
<h2 id="添加切面"><span class="post-title-index">1.3. </span><a href="#添加切面" class="headerlink" title="添加切面"></a>添加切面</h2><p>接下来，为了测试切面的各个Advice，编写切面类：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> space.wudi.readsourceaop.jdkdynamicproxy.aspect;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.JoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> space.wudi.readsourceaop.jdkdynamicproxy.bean.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicInteger;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogAspect</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> AtomicInteger i = <span class="keyword">new</span> AtomicInteger(<span class="number">1</span>);</span><br><span class="line">    <span class="comment">//配置切入点，所有满足条件的函数都会被加入监控</span></span><br><span class="line">    <span class="meta">@Pointcut</span>(value = <span class="string">"execution(* space.wudi.readsourceaop.controller..*.*(..))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">log</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">    <span class="comment">//配置Before通知</span></span><br><span class="line">    <span class="meta">@Before</span>(value=<span class="string">"log()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">logBeforeController</span><span class="params">(JoinPoint joinPoint)</span></span>&#123;</span><br><span class="line">        System.out.printf(<span class="string">"%d---before %s, args: %s\n"</span>, i.getAndIncrement(), joinPoint.getSignature(), Arrays.toString(joinPoint.getArgs()));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//配置Around通知</span></span><br><span class="line">    <span class="meta">@Around</span>(<span class="string">"log()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">logAroundController</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        System.out.printf(<span class="string">"%d---around before %s, args: %s\n"</span>, i.getAndIncrement(), joinPoint.getSignature(), Arrays.toString(joinPoint.getArgs()));</span><br><span class="line">        Object rtVal = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            rtVal = joinPoint.proceed();</span><br><span class="line">        &#125;<span class="keyword">catch</span>(Throwable throwable)&#123;</span><br><span class="line">            String str = throwable.toString();</span><br><span class="line">            System.out.printf(<span class="string">"%d---around after %s, catch: %s\n"</span>, i.getAndIncrement(), joinPoint.getSignature(), str);</span><br><span class="line">            rtVal = <span class="string">"error happen because: "</span> + str;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.printf(<span class="string">"%d---around after %s, returns: %s\n"</span>, i.getAndIncrement(), joinPoint.getSignature(), rtVal==<span class="keyword">null</span>?<span class="string">"null"</span>:rtVal.toString());</span><br><span class="line">        <span class="keyword">return</span> rtVal;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//配置AfterReturning通知</span></span><br><span class="line">    <span class="meta">@AfterReturning</span>(pointcut = <span class="string">"log()"</span>, returning = <span class="string">"rtVal"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">logAfterReturningController</span><span class="params">(JoinPoint joinPoint, Object rtVal)</span></span>&#123;</span><br><span class="line">        System.out.printf(<span class="string">"%d---after returning %s, args: %s, rtVal: %s[%s]\n"</span>, i.getAndIncrement(), joinPoint.getSignature(), Arrays.toString(joinPoint.getArgs()), rtVal.toString(), rtVal.getClass());</span><br><span class="line">        <span class="comment">//修改return的值</span></span><br><span class="line">        <span class="keyword">if</span>(rtVal <span class="keyword">instanceof</span> String)&#123;</span><br><span class="line">            rtVal = ((String)rtVal)+<span class="string">" modified by aspect"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(rtVal <span class="keyword">instanceof</span> User)&#123;</span><br><span class="line">            ((User)rtVal).setEmail(<span class="string">"modified by aspect"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//配置After通知</span></span><br><span class="line">    <span class="meta">@After</span>(<span class="string">"log()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">logController</span><span class="params">(JoinPoint joinPoint)</span></span>&#123;</span><br><span class="line">        System.out.printf(<span class="string">"%d---after %s, args: %s\n"</span>, i.getAndIncrement(), joinPoint.getSignature(), Arrays.toString(joinPoint.getArgs()));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//配置AfterThrowing通知</span></span><br><span class="line">    <span class="meta">@AfterThrowing</span>(pointcut = <span class="string">"log()"</span>, throwing = <span class="string">"exception"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">logAfterThrowingController</span><span class="params">(JoinPoint joinPoint, Exception exception)</span></span>&#123;</span><br><span class="line">        System.out.printf(<span class="string">"%d---after throwing %s, args: %s, exception: %s\n"</span>, i.getAndIncrement(), joinPoint.getSignature(), Arrays.toString(joinPoint.getArgs()), exception.toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>上面一共使用了<code>@Before</code>、<code>@After</code>、<code>@Around</code>、<code>@AfterReturning</code>、<code>@AfterThrowing</code>这所有的5个Advice。</p>
<h2 id="测试"><span class="post-title-index">1.4. </span><a href="#测试" class="headerlink" title="测试"></a>测试</h2><h3 id="调用-greeting"><span class="post-title-index">1.4.1. </span><a href="#调用-greeting" class="headerlink" title="调用/greeting"></a>调用<code>/greeting</code></h3><p>调用<code>/greeting?fromInfo=WuDi</code>，浏览器返回：<br><img src="/2020/12/11/ReadSource-SpringAop-01Usage/UseAOP-Greeting.png" alt="GreetingResponse"><br>同时标准输出得到：  </p>
<blockquote>
<p>1—-<strong>around before</strong> String space.wudi.readsourceaop.controller.MyController.getInfo(String), args: [WuDi]<br>2—-<strong>before</strong> String space.wudi.readsourceaop.controller.MyController.getInfo(String), args: [WuDi]<br>3—-<strong>after returning</strong> String space.wudi.readsourceaop.controller.MyController.getInfo(String), args: [WuDi], rtVal: Hi, WuDi![class java.lang.String]<br>4—-<strong>after</strong> String space.wudi.readsourceaop.controller.MyController.getInfo(String), args: [WuDi]<br>5—-<strong>around after</strong> String space.wudi.readsourceaop.controller.MyController.getInfo(String), returns: Hi, WuDi!  </p>
</blockquote>
<h3 id="调用-userinfo"><span class="post-title-index">1.4.2. </span><a href="#调用-userinfo" class="headerlink" title="调用/userinfo"></a>调用<code>/userinfo</code></h3><p>调用<code>/userinfo?fromInfo=WuDi</code>，浏览器返回：<br><img src="/2020/12/11/ReadSource-SpringAop-01Usage/UseAOP-Userinfo.png" alt="UserInfoResponse"><br>同时标准输出得到： </p>
<blockquote>
<p>1—-<strong>around</strong> before User space.wudi.readsourceaop.controller.MyController.getUserInfo(String), args: [WuDi]<br>2—-<strong>before</strong> User space.wudi.readsourceaop.controller.MyController.getUserInfo(String), args: [WuDi]<br>3—-<strong>after</strong> returning User space.wudi.readsourceaop.controller.MyController.getUserInfo(String), args: [WuDi], rtVal: space.wudi.readsourceaop.bean.User@a5d1bbd[class space.wudi.readsourceaop.bean.User]<br>4—-<strong>after</strong> User space.wudi.readsourceaop.controller.MyController.getUserInfo(String), args: [WuDi]<br>5—-<strong>around after</strong> User space.wudi.readsourceaop.controller.MyController.getUserInfo(String), returns: space.wudi.readsourceaop.bean.User@a5d1bbd  </p>
</blockquote>
<h3 id="调用-exception"><span class="post-title-index">1.4.3. </span><a href="#调用-exception" class="headerlink" title="调用/exception"></a>调用<code>/exception</code></h3><p>调用<code>/exception</code>，浏览器返回：<br><img src="/2020/12/11/ReadSource-SpringAop-01Usage/UseAOP-Exception.png" alt="Exception"><br>同时标准输出得到： </p>
<blockquote>
<p>1—-<strong>around before</strong> String space.wudi.readsourceaop.controller.MyController.throwException(), args: []<br>2—-<strong>before</strong> String space.wudi.readsourceaop.controller.MyController.throwException(), args: []<br>3—-<strong>after throwing</strong> String space.wudi.readsourceaop.controller.MyController.throwException(), args: [], exception: java.lang.RuntimeException: an error occurred in controller<br>4—-<strong>after</strong> String space.wudi.readsourceaop.controller.MyController.throwException(), args: []<br>5—-<strong>around after</strong> String space.wudi.readsourceaop.controller.MyController.throwException(), catch: java.lang.RuntimeException: an error occurred in controller<br>6—-<strong>around after</strong> String space.wudi.readsourceaop.controller.MyController.throwException(), returns: error happen because: java.lang.RuntimeException: an error occurred in controller  </p>
</blockquote>
<h1 id="分析——不同AOP版本Advice顺序不同"><span class="post-title-index">2. </span><a href="#分析——不同AOP版本Advice顺序不同" class="headerlink" title="分析——不同AOP版本Advice顺序不同"></a>分析——不同AOP版本Advice顺序不同</h1><p>从上面的调用结果来看，其执行过程和网上所说的还不太一样。网上说的大概是这样的流程：<br><img src="/2020/12/11/ReadSource-SpringAop-01Usage/UseAOP-OriginAdviseFlow.png" alt="OriginAdviceFlow"><br>也就是<code>@Around</code>只包裹了<code>@Before</code>和<code>invoke method</code>。而且先<code>@After</code>再执行<code>@AfterReturning</code>或<code>@AfterThrowing</code>。  </p>
<p>比如我测试了一下Spring Boot 2.1.0-RELEASE on Spring 5.1.2，其在<code>/greeting</code>接口下的输出是这样的：</p>
<blockquote>
<p>1—-<strong>around before</strong> String space.wudi.readsourceaop.controller.MyController.getInfo(String), args: [WuDi]<br>2—-<strong>before</strong> String space.wudi.readsourceaop.controller.MyController.getInfo(String), args: [WuDi]<br>3—-<strong>around after</strong> String space.wudi.readsourceaop.controller.MyController.getInfo(String), returns: Hi, WuDi!<br>4—-<strong>after</strong> String space.wudi.readsourceaop.controller.MyController.getInfo(String), args: [WuDi]<br>5—-<strong>after returning</strong> String space.wudi.readsourceaop.controller.MyController.getInfo(String), args: [WuDi], rtVal: Hi, WuDi![class java.lang.String]   </p>
</blockquote>
<p>而从我使用的版本上（Spring-AOP-5.3.1）的输出可以看出来，大致是这样的：<br><img src="/2020/12/11/ReadSource-SpringAop-01Usage/UseAOP-NowAdviseFlow.png" alt="NowAdviceFlow"><br>也就<code>@Around</code>包裹了所有的过程，且<code>@After</code>被挪到了<code>@AfterReturning</code>和<code>@AfterThrowing</code>之后。  </p>
<p>具体什么时候发生的在官方文档里，找了半天终于找到了，<a href="https://docs.spring.io/spring-framework/docs/5.3.1/reference/html/core.html#aop-ataspectj-advice-ordering" target="_blank" rel="noopener">传送门</a>。这里截图看一下：<br><img src="/2020/12/11/ReadSource-SpringAop-01Usage/OfficialDocForOrder.png" alt="官方文档"><br>大致翻译一下：</p>
<blockquote>
<p>Spring Framework 5.2.7版本（开始，【我从上下文推理出来的】），定义在同一个<code>@Aspect</code>修饰的class中的advice方法，在同一个Join Point处运行时，将按照下面的优先级从高到低排列：<code>@Around</code>、<code>@Before</code>、<code>@After</code>、<code>@AfterReturning</code>、<code>@AfterThrowing</code>。然而请注意，由于Spring <code>AspectJAfterAdvice</code>的实现，<code>@After</code> advice方法将实际上会在<code>@Aspect</code>中<code>@AfterReturning</code>或<code>@AfterThrowing</code>执行之后，才会被调用。<br>当两个相同类型的advice（比如两个<code>@After</code>）的advice函数，需要在一个相同的<code>@Aspect</code>中的同一个join point处执行，其源码中的位置是无法通过用javac编译过的class文件确定的。这样的话，可以考虑在各个<code>@Aspect</code>中，将多个在同一个Join Point处执行的（相同的）advice合并成一个；或者将同一个<code>@Aspect</code>中，将这些advice拆分到不同的<code>@Aspect</code>中，这样就可以使用<code>Ordered</code>接口或者<code>@Order</code>注解去指定顺序了。 </p>
</blockquote>
<p>这是什么意思呢，翻看一下<code>AspectJAfterAdvice.java</code>的源码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AspectJAfterAdvice</span> <span class="keyword">extends</span> <span class="title">AbstractAspectJAdvice</span></span></span><br><span class="line"><span class="class">		<span class="keyword">implements</span> <span class="title">MethodInterceptor</span>, <span class="title">AfterAdvice</span>, <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">	<span class="comment">//constructor</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">	<span class="meta">@Nullable</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(MethodInvocation mi)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> mi.proceed();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">finally</span> &#123;</span><br><span class="line">			invokeAdviceMethod(getJoinPointMatch(), <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//other methods</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>从这里可以看到，这个<code>invoke(MethodInvocation)</code>方法，换句话说就是这个<code>@After</code> advice，一定是在<code>AfterReturning</code>或者<code>AfterThrowing</code>之前进入的，但进入之后，首先执行的是<code>mi.process()</code>，在此过程中<code>return</code>或者<code>throw</code>，最后在<code>finally</code>中才会执行<code>invokeAdviceMethod()</code>。这样的话，差不多就理解了，<code>@After</code> Advice的优先级高，所以先进入调用栈，但是执行靠后，所以造成了输出晚。<br>再看一下调用栈，我在Aspect中的<code>logAfterReturningController()</code>里第一行下来一个断点，执行<code>/greeting?fromInfo=WuDi</code>，得到如下调用栈：（Spring AOP 5.3.1）<br><img src="/2020/12/11/ReadSource-SpringAop-01Usage/CallStackForAfterReturning.png" alt="AfterReturningCallStack"><br>可以看到左下角的调用栈，从上往下数第1个红框的是我写的Aspect中的AfterReturning处理方法，第2个红框是<code>AfterReturningAdvice</code>代理类的，第3个红框是<code>AfterAdvice</code>代理类的，第4个是我写的Aspect里的Around处理方法，第5个是<code>AroundAdvice</code>代理类。</p>
<p>而同样的，我将AOP替换为Spring AOP 5.2.6，然后在<code>logAroundController()</code>中下断点，可以看到完全不一样的调用栈。<br><img src="/2020/12/11/ReadSource-SpringAop-01Usage/CallStackForAroundReturningOnOldVersion.png" alt="AroundCallStackOldVersion"></p>
<h2 id="结论"><span class="post-title-index">2.1. </span><a href="#结论" class="headerlink" title="结论"></a>结论</h2><p>从Spring AOP 5.2.7开始，各Advice的加载优先级从高到低分别是<code>@Around</code>、<code>@Before</code>、<code>@After</code>、<code>@AfterReturning</code>、<code>@AfterThrowing</code>。但是加载或者说进入优先级，仅代表了入栈的优先级，各Advice调用用户自定义编写的切面中的方法的顺序可能与上述的加载优先级不同。特别是<code>@After</code>，虽然是先入栈的，但它需要先调用目标对象的方法，在其退出后（这时就会调用<code>@AfterReturning</code>或<code>@AfterThrowing</code>）才会执行我们写的<code>@After</code>中的切面事件。</p>
<h1 id="AOP中的术语和解释"><span class="post-title-index">3. </span><a href="#AOP中的术语和解释" class="headerlink" title="AOP中的术语和解释"></a>AOP中的术语和解释</h1><h2 id="名词解释"><span class="post-title-index">3.1. </span><a href="#名词解释" class="headerlink" title="名词解释"></a>名词解释</h2><ul>
<li>Aspect（切面）：为了达成某种目的而设置的功能的集合。  </li>
<li>Pointcut（切入点）：为了实现切面Aspect，我们需要寻找在哪些地方切入。换句话说，Pointcut也可以理解成Join Point的筛选条件。  </li>
<li>Join Point（连接点）：在切入点处，切面和业务逻辑的实际交叉点。一个Pointcut可能存在不定个数的Join Point。  </li>
<li>Advice（通知）：在切入点不同位置处，应当在切面中增加的执行事件。   </li>
<li>TargetObject（目标对象）：Join Point所在的对象叫做目标对象。  </li>
<li>AOP Proxy（代理对象）：我们知道，在应用AOP之前，Spring框架是直接执行Target Object中的方法的。但在使用AOP之后，会创建一个对象，代理其行为，在调用其中的那些方法前后增加Advice点。  </li>
<li>Introduction（引入）：通常用于静态代理，为一个类型增加额外的方法或属性。  </li>
<li>weave（织入）：生成代理对象并将其替代原本应由目标对象承担角色的位置的过程。Weaving可以发生在编译期（如使用AspectJ）、类加载期（通常需要特定的类加载器）、运行时（比如Spring AOP）。</li>
</ul>
<h2 id="举个例子"><span class="post-title-index">3.2. </span><a href="#举个例子" class="headerlink" title="举个例子"></a>举个例子</h2><p>为了记录日志，所以需要日志切面，因此创建了一个<code>LogAspect</code>；为了提高计算或者查询效率，需要使用缓存，所以需要添加缓存切面，因此创建了<code>CacheAspect</code>。  </p>
<p>在<code>LogAspect</code>中，我们需要在所有接口进入的时候、所有数据库访问时添加日志记录，那么这就是<code>LogAspect</code>中的两个Pointcut（<code>apiAccessLogPointcut</code>、<code>dbAccessLogPointcut</code>）；而对于<code>CacheAspect</code>，可能就需要制定特定的某个或某些切入点，比如读取配置文件的函数（<code>configLoadCachePointcut</code>）。</p>
<p>具体执行到用户登录接口对应的<code>login(LoginInfo)</code>方法了，那么这个用户登录接口就是一个连接点；在进行查询用户信息时<code>userDao.findUserByUsername(String)</code>就是。</p>
<p>在所有接口进入的切入点<code>apiAccessLogPointcut</code>，产品经理要求记录接口调用成功和失败的情况，那么就分别需要在这些接口的<code>@AfterReturning</code>和<code>@AfterThrowing</code>两个位置进行通知（Advise）。 </p>
<p><code>login(LoginInfo)</code>这个方法所在的<code>UserController</code>的bean就是目标对象；<code>userDao</code>也是一个目标对象。</p>
<p>这样被创建的对象叫做代理对象。比如上一个图中，调用栈最下面那个<code>getInfo()</code>本来是存在于MyController中的，但实际执行的是由AOP框架创建的<code>MyController$$EnhancedBySpringCGLIB$$95c1c5e</code>的实例中的同名函数。  </p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E6%BA%90%E7%A0%81/" rel="tag"># 源码</a>
              <a href="/tags/Spring/" rel="tag"># Spring</a>
              <a href="/tags/AOP/" rel="tag"># AOP</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/11/03/TodoList-MakeTemplatesFrontend/" rel="prev" title="TodoList-创建前后端的模板并尝试发布·前端">
      <i class="fa fa-chevron-left"></i> TodoList-创建前后端的模板并尝试发布·前端
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/12/12/ReadSource-SpringAOP-02JdkDynamicProxy/" rel="next" title="阅读源码-SpringAOP-02JdkDynamicProxy">
      阅读源码-SpringAOP-02JdkDynamicProxy <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#用法用例"><span class="nav-text">1. 用法用例</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#创建工程"><span class="nav-text">1.1. 创建工程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#创建需要被插入切面的Controller"><span class="nav-text">1.2. 创建需要被插入切面的Controller</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#添加切面"><span class="nav-text">1.3. 添加切面</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#测试"><span class="nav-text">1.4. 测试</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#调用-greeting"><span class="nav-text">1.4.1. 调用&#x2F;greeting</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#调用-userinfo"><span class="nav-text">1.4.2. 调用&#x2F;userinfo</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#调用-exception"><span class="nav-text">1.4.3. 调用&#x2F;exception</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#分析——不同AOP版本Advice顺序不同"><span class="nav-text">2. 分析——不同AOP版本Advice顺序不同</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#结论"><span class="nav-text">2.1. 结论</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#AOP中的术语和解释"><span class="nav-text">3. AOP中的术语和解释</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#名词解释"><span class="nav-text">3.1. 名词解释</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#举个例子"><span class="nav-text">3.2. 举个例子</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="吴迪"
      src="/images/avatar.jpg?raw=true">
  <p class="site-author-name" itemprop="name">吴迪</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">34</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">49</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        
  <div class="beian"><a href="http://beian.miit.gov.cn/" rel="noopener" target="_blank">苏ICP备17000391号 </a>
  </div>

<div class="copyright">
  
  &copy; 2020 – 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">吴迪</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>


  <script src='https://unpkg.com/mermaid@7.1.2/dist/mermaid.min.js'></script>
  <script>
    if (window.mermaid) {
      var config = {
        theme:'default',
        logLevel:'fatal',
        securityLevel:'strict',
        startOnLoad:true,
        arrowMarkerAbsolute:false,

        er:{
          diagramPadding:20,
          layoutDirection:'TB',
          minEntityWidth:100,
          minEntityHeight:75,
          entityPadding:15,
          stroke:'gray',
          fill:'honeydew',
          fontSize:12,
          useMaxWidth:true,
        },
        flowchart:{
          diagramPadding:8,
          htmlLabels:true,
          curve:'linear',
        },
        sequence:{
          diagramMarginX:50,
          diagramMarginY:10,
          actorMargin:50,
          width:150,
          height:65,
          boxMargin:10,
          boxTextMargin:5,
          noteMargin:10,
          messageMargin:35,
          messageAlign:'center',
          mirrorActors:true,
          bottomMarginAdj:1,
          useMaxWidth:true,
          rightAngles:false,
          showSequenceNumbers:false,
        },
        gantt:{
          titleTopMargin:25,
          barHeight:20,
          barGap:4,
          topPadding:50,
          leftPadding:75,
          gridLineStartPadding:35,
          fontSize:11,
          fontFamily:'"Open-Sans", "sans-serif"',
          numberSectionStyles:4,
          axisFormat:'%Y-%m-%d',
        }
      };
      mermaid.initialize(config);
    }
  </script>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  













<script>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme    : 'forest',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    });
  }, window.mermaid);
}
</script>


  

  

  

</body>
</html>
