---
title: 多线程与高并发-进程内高并发
date: 2020-12-15 08:42:56
tags: [多线程, 进程, Synchronized, Thread]
categories: 多线程与高并发
mathjax: false
---
# 线程
## 线程的概念、启动方式、常用的方法（start、run、join、yeild、interrupt）

# 线程同步
## Synchronized的实现

### 锁升级的过程
当执行`synchronized(obj)`的时候，对象头上的markword中记录当前线程号，锁标记更改为“偏向锁biased lock”。此时相当于没有加锁。当只有本线程访问时，畅通无阻。（也就是偏向于该线程的意思）  
当其他线程过来访问时，obj升级为”自旋锁spinned lock"。自旋锁是一种乐观锁，认为该线程竞争情况不激烈。新线程每经过一个自旋周期，就会去尝试获取该锁。自旋锁是通过CPU的CAS指令去获取锁的，但是是在用户态。  
如果超过了阈值（通常是10）次数还没有获取到，该锁就会升级到重量级锁。重量级锁是系统层面的，内核态的。所以每次使用重量级锁，都会切换状态，开销很大。  

Java在改进后使用上述锁升级的过程，以提高效率。锁是只能升级不能降级的。  
### 自旋锁和重量级锁的选择
什么时候选择自旋锁：执行时间比较短，线程数比较少。
什么时候选择重量级锁：执行时间比较长，线程数比较多。

### 锁null可行么？